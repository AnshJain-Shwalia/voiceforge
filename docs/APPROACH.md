# Technical Approach - VoiceForge

## Preview Pane Implementation

### Why iframe?

The preview pane needs to display user-generated HTML/CSS/JS code safely while they're building with AI. An iframe provides:

1. **Live preview** of code generated by AI
2. **Isolation** of user-generated code from the builder interface (broken/malicious code won't crash the app)
3. **Real-time updates** as AI makes changes

### Implementation: Using `srcdoc`

```jsx
function WebsitePreview({ htmlCode, cssCode, jsCode }) {
  const iframeContent = `
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
          ${cssCode}
        </style>
      </head>
      <body>
        ${htmlCode}
        <script>
          ${jsCode}
        </script>
      </body>
    </html>
  `;

  return (
    <iframe
      srcDoc={iframeContent}
      sandbox="allow-scripts allow-same-origin allow-modals"
      style={{ width: '100%', height: '100vh', border: 'none' }}
      title="Website Preview"
    />
  );
}
```

### User Flow

1. **User talks to AI**: "Make the background blue"
2. **AI generates code**: Updates CSS
3. **App updates state**: New CSS code stored
4. **React re-renders iframe**: Preview updates instantly with `srcDoc`
5. **User sees changes**: Live in the preview pane

### Security: `sandbox` Attribute

```jsx
sandbox="allow-scripts allow-same-origin allow-modals"
```

**Permissions granted:**
- `allow-scripts`: User's JavaScript can run (needed for interactive sites)
- `allow-same-origin`: Allows iframe content manipulation for refreshing
- `allow-modals`: Allows alert/confirm/prompt (user might add these)

**Permissions denied (not included):**
- `allow-top-navigation`: Cannot hijack the builder interface
- `allow-popups`: Cannot spam popup windows
- `allow-forms`: Form submission disabled (per requirements)

### Key Benefits

✅ **Safe**: User's buggy/malicious code can't break the builder interface
✅ **Live**: Updates instantly when AI changes code
✅ **Isolated**: Separate CSS/JS scope from the builder app
✅ **Simple**: No need to deploy to see preview
✅ **No external files**: Everything inline, no server requests needed

### Alternative Approaches Considered

1. **Blob URLs**: More complex, requires cleanup, no advantage over `srcdoc`
2. **Data URLs**: Limited by URL length, harder to debug
3. **Direct DOM manipulation**: No isolation, risks breaking the builder
4. **Separate preview server**: Unnecessary complexity for MVP

### Future Enhancements

- Add viewport size controls (mobile/tablet/desktop preview)
- Error boundary to catch and display JavaScript errors
- Console output viewer for debugging
- Performance monitoring for user's code
